<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Relax Space</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { box-sizing: border-box; touch-action: manipulation; background-color: #1a1a1a; color: white; overscroll-behavior: none; }
.focus-outline:focus-visible { outline: 2px solid #ffffff; outline-offset: 3px; }

/* Animations */
@keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
.animate-fade { animation: fadeIn 0.3s ease-out forwards; }

/* Loading Spinner */
.loader { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #38bdf8; border-radius: 50%; width: 14px; height: 14px; animation: spin 1s linear infinite; display: inline-block; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Custom Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
</style>
</head>
<body>
<div id="relax-app" class="w-full h-full min-h-screen flex flex-col overflow-hidden">

<div id="auth-screen" class="w-full h-screen flex flex-col items-center justify-center p-6 z-50 absolute bg-[#1a1a1a]">
<div class="w-full max-w-md p-8 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-md flex flex-col items-center gap-4">
<h1 class="text-3xl font-bold tracking-tight text-[#38bdf8]">Relax Space</h1>
<p class="text-sm opacity-60" id="connection-status">Local Mode (Saved to Device)</p>
<form id="auth-form" class="w-full flex flex-col gap-3">
<input type="text" id="auth-username" class="w-full rounded-lg px-4 py-3 bg-[#0a0a0a] border border-white/20 text-white placeholder-white/30 focus:border-[#38bdf8] outline-none transition" placeholder="Username" required>
<button type="submit" class="w-full py-3 rounded-full bg-[#38bdf8] hover:bg-[#0ea5e9] text-black font-bold transition transform active:scale-95">Enter World</button>
</form>
</div>
</div>

<div id="main-app" class="hidden flex-1 flex flex-col h-screen overflow-hidden">

<header class="w-full px-4 py-3 border-b border-white/10 bg-white/5 flex justify-between items-center shrink-0">
<div class="flex flex-col">
<h1 id="header-title" class="text-lg font-bold">Community Hub</h1>
<div class="flex items-center gap-2 text-xs opacity-60">
<span id="user-display"></span>
<span id="sync-status" class="text-[#38bdf8] hidden"><div class="loader"></div> Syncing...</span>
</div>
</div>
<div class="flex items-center gap-2">
<button id="admin-data-btn" class="hidden text-xs bg-yellow-500 hover:bg-yellow-400 text-black font-extrabold px-3 py-1.5 rounded uppercase shadow-[0_0_10px_rgba(234,179,8,0.5)]">üìÇ DATA</button>
<button id="refresh-btn" class="text-xs border border-white/20 px-3 py-1.5 rounded hover:bg-white/10">‚Üª Refresh</button>
<button id="logout-btn" class="text-xs border border-white/20 px-3 py-1.5 rounded hover:bg-white/10">Exit</button>
</div>
</header>

<main class="flex-1 overflow-y-auto p-4 flex flex-col gap-6">

<section id="mood-section" class="w-full">
<h2 class="text-xs font-bold uppercase tracking-widest opacity-50 mb-2">Atmosphere</h2>
<div class="flex flex-wrap gap-2">
<button class="mood-btn px-4 py-1.5 rounded-full text-xs border border-white/10 bg-white/5 hover:bg-white/10 transition" data-color="#1a1a1a">üåë Dark</button>
<button class="mood-btn px-4 py-1.5 rounded-full text-xs border border-blue-500/30 bg-blue-500/10 hover:bg-blue-500/20 text-blue-200 transition" data-color="#0f172a">üåä Calm</button>
<button class="mood-btn px-4 py-1.5 rounded-full text-xs border border-purple-500/30 bg-purple-500/10 hover:bg-purple-500/20 text-purple-200 transition" data-color="#1e1b4b">‚ú® Dream</button>
<button class="mood-btn px-4 py-1.5 rounded-full text-xs border border-orange-500/30 bg-orange-500/10 hover:bg-orange-500/20 text-orange-200 transition" data-color="#2c100e">üî• Cozy</button>
</div>
</section>

<section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
<div class="rounded-xl p-4 border border-white/10 bg-white/5">
<h2 class="text-sm font-bold mb-3">Share a Thought</h2>
<textarea id="post-input" rows="2" class="w-full bg-black/20 rounded-lg p-3 text-sm border border-white/10 focus:border-[#38bdf8] outline-none resize-none" placeholder="Type here..."></textarea>
<div class="flex justify-end mt-2">
<button id="post-btn" class="px-5 py-1.5 bg-[#38bdf8] text-black text-xs font-bold rounded-full hover:bg-[#0ea5e9] transition">Post</button>
</div>
</div>

<div class="rounded-xl p-4 border border-white/10 bg-white/5 flex flex-col h-64">
<h2 class="text-sm font-bold mb-2 flex justify-between">
Feed
<span class="text-[10px] font-normal opacity-50" id="feed-source-label">Local Memory</span>
</h2>
<div id="feed-list" class="flex-1 overflow-y-auto flex flex-col gap-2 pr-2">
<div class="text-center text-xs opacity-50 mt-10">No posts yet.</div>
</div>
</div>
</section>

<section>
<h2 class="text-xs font-bold uppercase tracking-widest opacity-50 mb-3">Mini Games</h2>
<div class="flex flex-wrap gap-2 mb-4">
<button class="game-tab px-3 py-1.5 text-xs rounded border border-white/20 hover:bg-white/10" onclick="showGame('snake')">üêç Snake</button>
<button class="game-tab px-3 py-1.5 text-xs rounded border border-white/20 hover:bg-white/10" onclick="showGame('block')">üß± Blocks</button>
<button class="game-tab px-3 py-1.5 text-xs rounded border border-white/20 hover:bg-white/10" onclick="showGame('popcorn')">üçø Popcorn</button>
<button class="game-tab px-3 py-1.5 text-xs rounded border border-white/20 hover:bg-white/10" onclick="showGame('draw')">üé® Draw</button>
<button class="game-tab px-3 py-1.5 text-xs rounded border border-white/20 hover:bg-white/10" onclick="showGame('breathe')">ü´Å Breathe</button>
</div>

<div id="game-display" class="w-full rounded-xl border border-white/10 bg-black/40 overflow-hidden relative min-h-[300px] flex items-center justify-center">
<p class="text-sm opacity-40">Select a game above to play.</p>
</div>
</section>

</main>
</div>
</div>

<script>
// =========================================================
// ‚öôÔ∏è SETUP
// IF A PARENT GIVES YOU A LINK, PASTE IT BETWEEN THE QUOTES BELOW.
// IF IT IS EMPTY "", THE APP WORKS IN OFFLINE MODE.
const DATABASE_URL = "";
// Example: "https://script.google.com/macros/s/..../exec"

// URL to open if you are Admin and click the Data button
const SHEET_EDIT_URL = "https://docs.google.com/spreadsheets";
// =========================================================

let currentUser = "Ray_irl";
let appData = [];
let pollingInterval;

// Check if we are online or offline
const isOnline = DATABASE_URL.length > 10;

if(isOnline) {
document.getElementById('connection-status').innerText = "Online Cloud Mode";
document.getElementById('feed-source-label').innerText = "Live Cloud Data";
} else {
document.getElementById('connection-status').innerText = "Local Mode (Offline)";
document.getElementById('feed-source-label').innerText = "Local Memory";
}

// --- 1. AUTH & ADMIN ---
document.getElementById('auth-form').addEventListener('submit', (e) => {
e.preventDefault();
const input = document.getElementById('auth-username').value.trim();
if(!input) return;

currentUser = input;
document.getElementById('user-display').innerText = "User: " + currentUser;

// SWITCH SCREENS
document.getElementById('auth-screen').classList.add('hidden');
document.getElementById('main-app').classList.remove('hidden');

// ADMIN CHECK (Ray_irl)
if(currentUser === 'Ray_irl') {
const btn = document.getElementById('admin-data-btn');
btn.classList.remove('hidden');

if(isOnline) {
btn.onclick = () => window.open(SHEET_EDIT_URL, '_blank');
} else {
// If offline, Admin button clears local data
btn.onclick = () => {
if(confirm("Offline Mode: Clear all local data?")) {
localStorage.removeItem('relax_local_data');
location.reload();
}
};
}
}

// START SYNC
syncData();
// If online, check every 5 seconds. If offline, check every 1 second (fast local).
pollingInterval = setInterval(syncData, isOnline ? 5000 : 1000);
});

document.getElementById('logout-btn').onclick = () => location.reload();

// --- 2. DATA HANDLER (HYBRID) ---
async function syncData() {
if(isOnline) {
// ONLINE MODE
const indicator = document.getElementById('sync-status');
indicator.classList.remove('hidden');
try {
const res = await fetch(DATABASE_URL);
const data = await res.json();
appData = data.reverse();
renderFeed();
} catch(e) { console.error("Sync failed:", e); }
indicator.classList.add('hidden');
} else {
// OFFLINE MODE (LocalStorage)
const local = localStorage.getItem('relax_local_data');
if(local) {
appData = JSON.parse(local).reverse();
} else {
appData = [];
}
renderFeed();
}
}

async function sendData(type, content, extra = "") {
const payload = { type, user: currentUser, content, extra: extra || new Date().toLocaleTimeString() };

// Optimistic Update (Show it immediately)
appData.unshift(payload);
renderFeed();

if(isOnline) {
// Send to Google Sheet
try {
await fetch(DATABASE_URL, {
method: 'POST',
mode: 'no-cors',
headers: {'Content-Type': 'application/json'},
body: JSON.stringify(payload)
});
} catch(e) { alert("Failed to send to cloud."); }
} else {
// Save to LocalStorage
let currentStore = JSON.parse(localStorage.getItem('relax_local_data') || "[]");
currentStore.push(payload);
localStorage.setItem('relax_local_data', JSON.stringify(currentStore));
}
}

// --- 3. RENDERING ---
function renderFeed() {
const list = document.getElementById('feed-list');
list.innerHTML = "";

const posts = appData.filter(x => x.type === 'post');

if(posts.length === 0) {
list.innerHTML = '<div class="text-center text-xs opacity-50 mt-4">No posts yet.</div>';
return;
}

posts.forEach(p => {
const div = document.createElement('div');
div.className = "p-2.5 rounded bg-white/5 border border-white/5 animate-fade";
const isAdmin = p.user === 'Ray_irl';
div.innerHTML = `
<div class="flex justify-between items-baseline">
<span class="text-xs font-bold ${isAdmin ? 'text-yellow-400' : 'text-[#38bdf8]'}">
${p.user} ${isAdmin ? '<span class="bg-red-500 text-white px-1 rounded text-[9px]">ADMIN</span>' : ''}
</span>
<span class="text-[9px] opacity-40">${p.extra || ''}</span>
</div>
<div class="text-sm mt-1 break-words">${p.content}</div>
`;
list.appendChild(div);
});
}

document.getElementById('post-btn').onclick = () => {
const txt = document.getElementById('post-input');
if(txt.value.trim()) {
sendData('post', txt.value.trim());
txt.value = "";
}
};
document.getElementById('refresh-btn').onclick = syncData;

// --- 4. MOODS ---
document.querySelectorAll('.mood-btn').forEach(btn => {
btn.onclick = () => {
document.body.style.backgroundColor = btn.dataset.color;
};
});

// --- 5. GAME ENGINE (FIXED) ---
const gameContainer = document.getElementById('game-display');
let gameLoopRef = null;

window.showGame = function(gameName) {
if(gameLoopRef) cancelAnimationFrame(gameLoopRef);
// Clear Intervals just in case
let id = window.setInterval(function() {}, 0);
while (id--) { window.clearInterval(id); }
// Restore Sync Interval
pollingInterval = setInterval(syncData, isOnline ? 5000 : 1000);

gameContainer.innerHTML = '';
gameContainer.style.backgroundColor = '#000';

if(gameName === 'snake') startSnake();
if(gameName === 'block') startBlockBlast();
if(gameName === 'popcorn') startPopcorn();
if(gameName === 'draw') startDrawing();
if(gameName === 'breathe') startBreathing();
};

// --- GAME 1: SNAKE ---
function startSnake() {
gameContainer.innerHTML = `
<canvas id="snake-cvs" width="400" height="300" class="border border-white/20"></canvas>
<div class="absolute top-2 left-2 text-xs text-[#38bdf8]">Arrow Keys to Move</div>
<div id="snake-score" class="absolute top-2 right-2 text-xs font-bold">Score: 0</div>
`;
const cvs = document.getElementById('snake-cvs');
const ctx = cvs.getContext('2d');
let snake = [{x:10, y:10}, {x:9,y:10}, {x:8,y:10}];
let dx = 1, dy = 0;
let food = {x:15, y:10};
let score = 0;
let lastTime = 0;

document.onkeydown = e => {
if(e.key==='ArrowUp' && dy!==1) {dx=0;dy=-1;}
if(e.key==='ArrowDown' && dy!==-1) {dx=0;dy=1;}
if(e.key==='ArrowLeft' && dx!==1) {dx=-1;dy=0;}
if(e.key==='ArrowRight' && dx!==-1) {dx=1;dy=0;}
};

function loop(timestamp) {
if (timestamp - lastTime < 100) {
gameLoopRef = requestAnimationFrame(loop);
return;
}
lastTime = timestamp;
const head = {x: snake[0].x + dx, y: snake[0].y + dy};

// Collision checks
if(head.x<0 || head.x>=20 || head.y<0 || head.y>=15 || snake.some(s => s.x === head.x && s.y === head.y)) {
ctx.fillStyle = "white"; ctx.fillText("GAME OVER", 160, 150);
return;
}

snake.unshift(head);
if(head.x === food.x && head.y === food.y) {
score++;
document.getElementById('snake-score').innerText = "Score: " + score;
food = {x: Math.floor(Math.random()*20), y: Math.floor(Math.random()*15)};
} else {
snake.pop();
}

// Draw
ctx.fillStyle = "#1a1a1a"; ctx.fillRect(0,0,400,300);
ctx.fillStyle = "#ef4444"; ctx.fillRect(food.x*20, food.y*20, 18, 18);
ctx.fillStyle = "#38bdf8"; snake.forEach(s => ctx.fillRect(s.x*20, s.y*20, 18, 18));
gameLoopRef = requestAnimationFrame(loop);
}
gameLoopRef = requestAnimationFrame(loop);
}

// --- GAME 2: BLOCK BLAST ---
function startBlockBlast() {
gameContainer.innerHTML = `
<div class="flex flex-col items-center gap-2">
<div class="text-xs">Click blocks to clear!</div>
<div id="bb-grid" class="grid grid-cols-8 gap-1 p-2 bg-white/5 rounded"></div>
<div id="bb-score">Score: 0</div>
</div>
`;
const grid = document.getElementById('bb-grid');
const colors = ['bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500'];
let score = 0;
for(let i=0; i<64; i++) {
const btn = document.createElement('div');
let c = colors[Math.floor(Math.random()*colors.length)];
btn.className = `w-8 h-8 rounded ${c} cursor-pointer hover:opacity-80 transition`;
btn.onclick = () => {
score += 10;
document.getElementById('bb-score').innerText = "Score: " + score;
btn.className = `w-8 h-8 rounded ${colors[Math.floor(Math.random()*colors.length)]} cursor-pointer animate-fade`;
};
grid.appendChild(btn);
}
}

// --- GAME 3: POPCORN ---
function startPopcorn() {
gameContainer.innerHTML = '<canvas id="pop-cvs" width="400" height="300"></canvas>';
const ctx = document.getElementById('pop-cvs').getContext('2d');
let kernels = [];

document.getElementById('pop-cvs').onclick = (e) => {
const rect = e.target.getBoundingClientRect();
kernels.push({
x: e.clientX - rect.left, y: e.clientY - rect.top,
vx: (Math.random()-0.5)*10, vy: -10, popped: false
});
};

function loop() {
ctx.fillStyle = "#1a1a1a"; ctx.fillRect(0,0,400,300);
ctx.fillStyle = "#fff"; ctx.fillText("Click to spawn popcorn!", 10, 20);

kernels.forEach(k => {
k.x += k.vx; k.y += k.vy; k.vy += 0.5;
if(k.y > 290) { k.y = 290; k.vy *= -0.6; }
if(k.x < 0 || k.x > 400) k.vx *= -1;
if(!k.popped && Math.abs(k.vy) < 1 && k.y > 280) k.popped = true;

ctx.beginPath();
if(k.popped) {
ctx.fillStyle = "#facc15"; ctx.arc(k.x, k.y, 6, 0, Math.PI*2); ctx.fill();
} else {
ctx.fillStyle = "#a16207"; ctx.fillRect(k.x-3, k.y-3, 6, 6);
}
});
gameLoopRef = requestAnimationFrame(loop);
}
loop();
}

// --- GAME 4: DRAWING ---
function startDrawing() {
gameContainer.innerHTML = `
<div class="relative w-full h-full flex flex-col">
<div class="absolute top-2 left-2 flex gap-2">
<button class="p-1 bg-red-500 rounded-full w-6 h-6" onclick="window.dColor='#ef4444'"></button>
<button class="p-1 bg-blue-500 rounded-full w-6 h-6" onclick="window.dColor='#3b82f6'"></button>
<button class="p-1 bg-white rounded-full w-6 h-6" onclick="window.dColor='#ffffff'"></button>
<button class="px-2 py-0.5 bg-white/10 text-[10px] rounded" onclick="window.dCtx.clearRect(0,0,400,300)">Clear</button>
</div>
<canvas id="draw-cvs" width="400" height="300" class="cursor-crosshair"></canvas>
</div>
`;
const cvs = document.getElementById('draw-cvs');
window.dCtx = cvs.getContext('2d');
window.dColor = "#ffffff";
let painting = false;

cvs.addEventListener('mousedown', (e) => { painting = true; draw(e); });
cvs.addEventListener('mouseup', () => { painting = false; dCtx.beginPath(); });
cvs.addEventListener('mousemove', draw);

function draw(e) {
if(!painting) return;
const rect = cvs.getBoundingClientRect();
dCtx.lineWidth = 3; dCtx.lineCap = 'round'; dCtx.strokeStyle = dColor;
dCtx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
dCtx.stroke(); dCtx.beginPath();
dCtx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
}
}

// --- GAME 5: BREATHING ---
function startBreathing() {
gameContainer.innerHTML = `
<div class="flex flex-col items-center justify-center h-full">
<div id="breath-circle" class="w-32 h-32 rounded-full border-4 border-[#38bdf8] flex items-center justify-center transition-all duration-[4000ms] ease-in-out">
<span id="breath-text" class="text-sm">Inhale</span>
</div>
</div>
`;
const c = document.getElementById('breath-circle');
const t = document.getElementById('breath-text');
let inhale = true;
setTimeout(() => { c.style.transform = "scale(1.5)"; }, 100);
setInterval(() => {
inhale = !inhale;
t.innerText = inhale ? "Inhale" : "Exhale";
c.style.transform = inhale ? "scale(1.5)" : "scale(1.0)";
}, 4000);
}
</script>
</body>
</html>


